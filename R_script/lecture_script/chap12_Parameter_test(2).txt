############################################
### 2. T분포와 검정(ppt.37~41)   
############################################
# - 모집단 정규분포이고, 모집단의 분산(σ2)이 알려지지 않은 경우(n < 30)
# - 표본의 표준편차이용 모평균 검정 

# [가정]
# 우리나라 중2 남학생 평균키=168cm, 표준편차=3cm 알려질 때 
# 표본 29명을 대상으로 95신뢰수준에서 모평균의 신뢰구간 추정한다.

# 귀무가설(HO) : 모평균 168cm와 차이가 없다.(𝜇 = 168cm)
# 대립가설(H1) : 모평균 168cm와 차이가 있다.(𝜇 ≠ 168cm)

# 단계1. 표본 추출 : 모집단에서 28명 표본 추출  
x <- rnorm(29, mean=168, sd = 3) 
hist(x) # 좌우 대칭 확인 
mean(x) # 표본평균
sd(x) # 표본표준편차 


# 단계2. 정규성 검정 : 대칭분포 아닌 경우 다시 sampling  
shapiro.test(x) # 정규성검정 : 정규분포와 차이가 없다.


# 정규분포(모수검정) : t.test(x, mu)
# 비정규분포(비모수검정) : wilcox.test(x, mu)


# 단계3. T검정 : 분산을 모르는 경우  
t.test(x, alternative = 'two.sided', mu=168, conf.level = 0.95)   


# 단계4. t값(t검정통계량) 
mu = 168 # 모평균 
x_bar <- mean(x) # 표본평균 
S = sd(x) # 표본 표준편차
n <- length(x)

t_value <- (x_bar - mu) / (S / sqrt(n))


# 단계5. 가설검정 : 양측검정 결과 : 채택 or 기각
# [방법1] t값 해석 : 95% 신뢰수준에서 t값이 ±t임계값에 있는 경우 가설 채택  
# [방법2] p-value 해석 : p-value > 유의수준(0.05) 이면 귀무가설 채택  

# t임계값 구하기 : T분포표(자유도(df), 유의수준(alpha) 이용)   


# 단계6. 가설검정 결과 해석 
# [해설] 95% 신뢰수준에서 t검정을 수행한 결과 t통계량=1.2088 
# t통계량은 t 임계값 영역에 포함되어 가설 채택 



######################################
### t검정의 단측검정 예
######################################

# 1) 좌측검정
# 귀무가설(HO) : 모평균 168cm와 차이가 없다.(𝜇 = 168cm)
# 대립가설(H1) : 모평균 168cm 보다 작다.(𝜇 < 168cm) : 평균보다 작은 경우
t.test(x, mu=168, alternative = 'less', conf.level = 0.95) 

# 2) 우측검정 
# 귀무가설(HO) : 모평균 168cm와 차이가 없다.(𝜇 = 168cm)
# 대립가설(H1) : 모평균 168cm 보다 크다.(𝜇 > 168cm) : 평균보다 큰 경우
t.test(x, mu=168, alternative = 'greater', conf.level = 0.95)  



